name: 🤖 SFTP Deploy 🚀
on: [push]
jobs:
  discord_message_job:
    runs-on: ubuntu-latest
    name: discord message
    env:
      event_file: "$GITHUB_EVENT_PATH"
      event_data: open(event_file, "r").read()
      event_json: json.loads(event_data)
      modified_files: event_json["commit"]["modified"]
    steps:
      - name: Set variable to commit modifications
        env:
            COMMIT_MODIFICATIONS: ${{ toJson(github.event.commits) }}
        run: |
            echo "Commit modifications: ${COMMIT_MODIFICATIONS}"
      - name: Discord message
        uses: rjstone/discord-webhook-notify@v1
        with:
          severity: info
          username: ${{ github.actor }} 
          color: '#25A2FE'
          avatarUrl: https://github.githubassets.com/images/modules/logos_page/Octocat.png
          description: ${{ github.actor }} has commited ${{ github.event.head_commit.message }}.
          details: ''
          footer: This is a footer.
          text: New commit (${{ github.event.head_commit.message }})
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
          
          
          
  deploy_job:
     runs-on: ubuntu-latest
     name:  deploy
     steps:
       - name: 🔍️ Checkout 📝
         uses: actions/checkout@v2
                    
       - name: 🌐 Deploy file 📦️
         uses: wlixcc/SFTP-Deploy-Action@v1.2.4
         with: 
           username: ${{ secrets.FTP_USER }}
           server: ${{ secrets.FTP_SERVER }} 
           port: ${{ secrets.FTP_PORT }}
           local_path: './*'
           remote_path: '/plugins/Skript/scripts/'
           sftp_only: true
           password: ${{ secrets.FTP_PASSWORD }}
