name: 🤖 SFTP Deploy 🚀
on: [push]
jobs:
  discord_message_job:
    runs-on: ubuntu-latest
    name: discord message
    steps:
      - name: Set variable to modified files
        run: |
          modified_files=$(jq -r '.commits[].modified' ${{ GITHUB_EVENT_PATH }})
          echo "file: $modified_files"
          
      - name: Iterate over modified files
        run: |
          for file in $modified_files; do
            echo "Processing file: $file"
          done



      - name: Discord message
        uses: rjstone/discord-webhook-notify@v1
        with:
          severity: info
          username: ${{ github.actor }} 
          color: '#25A2FE'
          avatarUrl: https://github.githubassets.com/images/modules/logos_page/Octocat.png
          description: ${{ github.actor }} has commited ${{ github.event.head_commit.message }}.
          details: '${{ github.event.commit.modified }}'
          footer: This is a footer.
          text: New commit (${{ github.event.head_commit.message }})
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
          
          
          
  deploy_job:
     runs-on: ubuntu-latest
     name:  deploy
     steps:
       - name: 🔍️ Checkout 📝
         uses: actions/checkout@v2
                    
       - name: 🌐 Deploy file 📦️
         uses: wlixcc/SFTP-Deploy-Action@v1.2.4
         with: 
           username: ${{ secrets.FTP_USER }}
           server: ${{ secrets.FTP_SERVER }} 
           port: ${{ secrets.FTP_PORT }}
           local_path: './*'
           remote_path: '/plugins/Skript/scripts/'
           sftp_only: true
           password: ${{ secrets.FTP_PASSWORD }}
